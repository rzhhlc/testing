<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setting the Table</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --puzzle-dim-screen: 4in;
            --puzzle-dim-print: 5in;
            --sum-size: 48px; 
            --gap: 12px;      
        }

        body {
            background-color: #f8fafc;
            font-family: system-ui, -apple-system, sans-serif;
            position: relative;
        }

        .puzzle-wrapper {
            width: var(--puzzle-dim-screen);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .puzzle-assembly {
            display: grid;
            width: 100%;
            grid-template-columns: 1fr var(--gap) var(--sum-size);
            grid-template-rows: 1fr var(--gap) var(--sum-size);
        }

        .table-proper {
            grid-column: 1;
            grid-row: 1;
            display: grid;
            background-color: white;
            border: 2pt solid black; 
            aspect-ratio: 1 / 1;    
        }

        .cell {
            border: 1pt solid black; 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 1.25rem;
            outline: none;
            background: transparent;
            appearance: textfield;
        }

        .cell input::-webkit-outer-spin-button,
        .cell input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .pre-filled {
            background-color: #f1f5f9;
            font-weight: bold;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .row-sums-container {
            grid-column: 3;
            grid-row: 1;
            display: grid;
            gap: 4px;
        }

        .col-sums-container {
            grid-column: 1;
            grid-row: 3;
            display: grid;
            gap: 4px;
        }

        .sum-box {
            border: 1pt solid black;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            border-radius: 8px;
        }

        .id-display {
            font-family: monospace;
            font-size: 0.9rem;
            color: #475569;
            margin-top: 1.5rem;
            text-align: center;
        }

        /* Modal Styles */
        #exampleModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 50;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .example-page {
            background: white;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            display: none;
            padding: 3rem 4rem;
            font-family: serif;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .example-page.active {
            display: block;
        }

        /* Tutorial Table Styles */
        .tutorial-grid-container {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            margin: 1.5rem auto;
            justify-content: center;
        }

        .tutorial-table {
            display: grid;
            border: 2px solid black;
            background: white;
        }
        
        .grid-3x3 { grid-template-columns: repeat(3, 50px); grid-template-rows: repeat(3, 50px); }
        .grid-4x4 { grid-template-columns: repeat(4, 50px); grid-template-rows: repeat(4, 50px); }

        .t-cell {
            border: 1px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.15rem;
            font-weight: bold;
            width: 50px;
            height: 50px;
        }

        .t-sum-side {
            display: grid;
            gap: 4px;
        }
        .side-3 { grid-template-rows: repeat(3, 50px); }
        .side-4 { grid-template-rows: repeat(4, 50px); }

        .t-sum-bottom {
            display: grid;
            gap: 12px;
            margin-top: 8px;
        }
        .bot-3 { grid-template-columns: repeat(3, 50px); padding-right: 62px; }
        .bot-4 { grid-template-columns: repeat(4, 50px); padding-right: 62px; }

        .t-sum-box {
            border: 1px solid #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            width: 35px;
            height: 50px;
            font-size: 0.85rem;
        }

        .t-sum-box-bottom {
            border: 1px solid #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            height: 32px;
            width: 50px;
            font-size: 0.85rem;
        }

        /* Footer logic */
        .print-footer {
            display: none;
        }

        @media print {
            @page { margin: 0.5in; }
            body { background: white !important; padding: 0; }
            .no-print { display: none !important; }
            .puzzle-wrapper {
                width: var(--puzzle-dim-print) !important;
                margin-top: 20px;
            }
            .id-display { color: black; }
            header { display: block !important; margin-bottom: 20px; }
            h1 { color: black !important; }
            p { color: #333 !important; }

            .print-footer {
                display: block !important;
                position: fixed;
                bottom: 0;
                left: 0;
                font-size: 12pt;
                color: black;
                white-space: pre;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Home Link -->
    <a href="index.html" class="absolute top-4 left-4 text-blue-600 hover:text-blue-800 flex items-center gap-1.5 font-medium no-print transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span>Home</span>
    </a>

    <!-- Main Game View -->
    <div id="mainView" class="max-w-3xl mx-auto space-y-6">
        <header class="text-center">
            <h1 class="text-3xl font-bold text-gray-900">Setting the Table</h1>
            <p id="subheading" class="text-gray-600 mt-1">Fill the grid with consecutive numbers.</p>
            <p class="text-gray-600">The sums of the rows and columns are shown.</p>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 space-y-4 no-print">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Grid Size (x ≥ 2)</label>
                    <input type="number" id="gridSize" min="2" max="10" value="3" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 !h-auto">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Puzzle ID</label>
                    <input type="text" id="puzzleIdInput" placeholder="Enter ID to regenerate" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 !h-auto">
                </div>
            </div>
            
            <div class="flex flex-wrap gap-2 pt-2">
                <button onclick="createNewPuzzle()" class="bg-blue-600 text-white px-5 py-2 rounded-md font-medium hover:bg-blue-700 transition">New Puzzle</button>
                <button onclick="showSolution()" class="bg-slate-100 text-slate-700 px-5 py-2 rounded-md font-medium hover:bg-slate-200 transition">Show Solution</button>
                <button onclick="openExample(1)" class="bg-purple-100 text-purple-700 px-5 py-2 rounded-md font-medium hover:bg-purple-200 transition">Example #1</button>
                <button onclick="openExample(2)" class="bg-purple-100 text-purple-700 px-5 py-2 rounded-md font-medium hover:bg-purple-200 transition">Example #2</button>
                <button onclick="window.print()" class="bg-gray-800 text-white px-5 py-2 rounded-md font-medium hover:bg-gray-900 transition">Print Puzzle</button>
            </div>
        </div>

        <div class="puzzle-wrapper">
            <div id="puzzleAssembly" class="puzzle-assembly"></div>
            <div id="idLabel" class="id-display">ID: </div>
        </div>
    </div>

    <!-- Example Modal -->
    <div id="exampleModal">
        <div class="max-w-[800px] mx-auto sticky top-0 z-[60] flex justify-between items-center bg-gray-900/90 text-white p-4 mb-4 rounded-lg shadow-lg no-print">
            <div class="flex gap-4 items-center">
                <button onclick="closeExample()" class="flex items-center gap-1.5 hover:text-blue-400 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span>Back to Puzzle</span>
                </button>
                <span id="pageIndicator" class="text-sm font-mono bg-gray-800 px-2 py-1 rounded">Page 1 / 3</span>
            </div>
            <div class="flex gap-2">
                <button onclick="prevPage()" class="p-2 hover:bg-gray-700 rounded transition-colors" id="prevBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <button onclick="nextPage()" class="p-2 hover:bg-gray-700 rounded transition-colors" id="nextBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button onclick="closeExample()" class="ml-4 p-2 hover:bg-red-500 rounded transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
        </div>

        <div id="examplePages">
            <!-- EXAMPLE 1 PAGES -->
            <div class="example-pages-group" id="group-1">
                <div class="example-page active" id="e1-p1">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <p>Here is a 3 x 3 table. The row sums are show at the right, the column sums at the bottom.</p>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-3x3">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">7</div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell"></div><div class="t-cell"></div>
                            </div>
                            <div class="t-sum-side side-3"><div class="t-sum-box">18</div><div class="t-sum-box">13</div><div class="t-sum-box">14</div></div>
                        </div>
                        <div class="t-sum-bottom bot-3"><div class="t-sum-box-bottom">13</div><div class="t-sum-box-bottom">21</div><div class="t-sum-box-bottom">11</div></div>
                    </div>
                    <p class="mt-8">We have the numbers 1 2 3 4 5 6 7 8 9 to work with. 21 – 7 = _ + _. So we need two numbers that sum to 14; candidates are: 5 + 9 and 6 + 8. We’ll just guess and hope for the best.</p>
                    <div class="flex flex-col items-center mt-4">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-3x3">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">7</div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell">6</div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell">8</div><div class="t-cell"></div>
                            </div>
                            <div class="t-sum-side side-3"><div class="t-sum-box">18</div><div class="t-sum-box">13</div><div class="t-sum-box">14</div></div>
                        </div>
                        <div class="t-sum-bottom bot-3"><div class="t-sum-box-bottom">13</div><div class="t-sum-box-bottom">21</div><div class="t-sum-box-bottom">11</div></div>
                    </div>
                </div>

                <div class="example-page" id="e1-p2">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <p>Since 13 is the smallest row, we’ll try that next: 13 = 6 + _ + _. Candidates are: 2 + 5, 3 – 4. Guess again:</p>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-3x3">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">7</div><div class="t-cell"></div>
                                <div class="t-cell text-red-600">4</div><div class="t-cell">6</div><div class="t-cell text-red-600">3</div>
                                <div class="t-cell"></div><div class="t-cell">8</div><div class="t-cell"></div>
                            </div>
                            <div class="t-sum-side side-3"><div class="t-sum-box">18</div><div class="t-sum-box">13</div><div class="t-sum-box">14</div></div>
                        </div>
                        <div class="t-sum-bottom bot-3"><div class="t-sum-box-bottom">13</div><div class="t-sum-box-bottom">21</div><div class="t-sum-box-bottom">11</div></div>
                    </div>
                    <p class="mt-8">The only possibility for row 3 is: 14 = 8 – 1 + 5, but this won’t work: if you put 5 in column 3 then: 11 = 5 + 3 + 3 and if you put 1 in column 3 you get: 11 = 1 + 3 + 7. Let’s swap the 3 and 4 in row two and see what happens:</p>
                    <div class="flex flex-col items-center mt-4">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-3x3">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">7</div><div class="t-cell"></div>
                                <div class="t-cell text-red-600">3</div><div class="t-cell">6</div><div class="t-cell text-red-600">4</div>
                                <div class="t-cell"></div><div class="t-cell">8</div><div class="t-cell"></div>
                            </div>
                            <div class="t-sum-side side-3"><div class="t-sum-box">18</div><div class="t-sum-box">13</div><div class="t-sum-box">14</div></div>
                        </div>
                        <div class="t-sum-bottom bot-3"><div class="t-sum-box-bottom">13</div><div class="t-sum-box-bottom">21</div><div class="t-sum-box-bottom">11</div></div>
                    </div>
                </div>

                <div class="example-page" id="e1-p3">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <p>Now we try column three: 11 = 5 + 4 + 2, which works and then column one: 13 = 1 + 3 + 9, which also works.</p>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-3x3">
                                <div class="t-cell text-purple-600">9</div><div class="t-cell bg-blue-50">7</div><div class="t-cell text-purple-600">2</div>
                                <div class="t-cell text-red-600">3</div><div class="t-cell">6</div><div class="t-cell text-red-600">4</div>
                                <div class="t-cell text-purple-600">1</div><div class="t-cell">8</div><div class="t-cell text-purple-600">5</div>
                            </div>
                            <div class="t-sum-side side-3"><div class="t-sum-box">18</div><div class="t-sum-box">13</div><div class="t-sum-box">14</div></div>
                        </div>
                        <div class="t-sum-bottom bot-3"><div class="t-sum-box-bottom">13</div><div class="t-sum-box-bottom">21</div><div class="t-sum-box-bottom">11</div></div>
                    </div>
                    <p class="mt-8">Fortunately, the row one sum works out and the puzzle is solved. Our choice and placing of 6 and 8 at the start was lucky indeed! Is there a better strategy .. try to find one.</p>
                    <p class="mt-4 font-bold">Have fun!</p>
                </div>
            </div>

            <!-- EXAMPLE 2 PAGES -->
            <div class="example-pages-group" id="group-2" style="display:none;">
                <div class="example-page" id="e2-p1">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <p>Here is a 4x4 puzzle so we have the numbers 1 2 3 4 ... 14 15 16 to work with. Clearly we can put a 6 in row 4, column 2 since: 15 + 5 + 13 + 6 = 39</p>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">15</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell"></div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <div class="flex flex-col items-center mt-6">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">15</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell text-purple-600">6</div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <p class="mt-6">Luck is with us since we can put a 10 in row 4, column 1 since: 6 + 4 + 8 + 10 = 28.</p>
                </div>

                <div class="example-page" id="e2-p2">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">15</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell"></div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell text-orange-600">10</div><div class="t-cell text-purple-600">6</div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <p class="mt-8">Since column 1 needs only two more numbers, we give it a try. We need two numbers whose sum is 25, the allowed candidates are: 16 + 9 and 14 + 11. (The other possibilities: 15 + 10 and 13 + 12 use numbers that are already in the table.) We'll try 16 + 9:</p>
                    <div class="flex flex-col items-center mt-6">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell text-green-600">9</div><div class="t-cell bg-blue-50">15</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell text-green-600">16</div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell text-orange-600">10</div><div class="t-cell text-purple-600">6</div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <p class="mt-6">More guessing: row 1 needs a pair that sums to 14, the allowed candidates are: 2 + 12 and 3 + 11. Let's try 3 – 11:</p>
                </div>

                <div class="example-page" id="e2-p3">
                    <button onclick="closeExample()" class="text-blue-600 hover:underline mb-6 flex items-center gap-1 font-sans no-print text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Back to Puzzle</button>
                    <div class="flex flex-col items-center">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell text-green-600">9</div><div class="t-cell bg-blue-50">15</div><div class="t-cell text-blue-600">3</div><div class="t-cell text-blue-600">11</div>
                                <div class="t-cell text-green-600">16</div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell text-orange-600">10</div><div class="t-cell text-purple-600">6</div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <p class="mt-8">Lets work on row 3 (it has a large total which will limit possibilities). We need a pair that sums to 21. 7 + 14 is the only possibility.</p>
                    <div class="flex flex-col items-center mt-6">
                        <div class="tutorial-grid-container">
                            <div class="tutorial-table grid-4x4">
                                <div class="t-cell text-green-600">9</div><div class="t-cell bg-blue-50">15</div><div class="t-cell text-blue-600">3</div><div class="t-cell text-blue-600">11</div>
                                <div class="t-cell text-green-600">16</div><div class="t-cell bg-blue-50">5</div><div class="t-cell"></div><div class="t-cell"></div>
                                <div class="t-cell bg-blue-50">1</div><div class="t-cell bg-blue-50">13</div><div class="t-cell text-pink-600">7</div><div class="t-cell text-pink-600">14</div>
                                <div class="t-cell text-orange-600">10</div><div class="t-cell text-purple-600">6</div><div class="t-cell bg-blue-50">4</div><div class="t-cell bg-blue-50">8</div>
                            </div>
                            <div class="t-sum-side side-4"><div class="t-sum-box">38</div><div class="t-sum-box">35</div><div class="t-sum-box">35</div><div class="t-sum-box">28</div></div>
                        </div>
                        <div class="t-sum-bottom bot-4"><div class="t-sum-box-bottom">36</div><div class="t-sum-box-bottom">39</div><div class="t-sum-box-bottom">23</div><div class="t-sum-box-bottom">38</div></div>
                    </div>
                    <p class="mt-6">So row 2, column 3 must be 9, which is already used so it is not allowed. Where did we go wrong? So many possibilities! The order the numbers are placed matters, maybe the 7 and 14 should be swapped?? After seeing this example, no will want to play this game unless they come up with a better strategy! Start with a 2x2 or 3x3 table, and see how that goes!</p>
                    <p class="mt-4 font-bold">Have fun?</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Print-only footer -->
    <div class="print-footer">&nbsp;&nbsp;&nbsp;&nbsp;iyampuzzled.org&nbsp;&nbsp;&nbsp;&nbsp;</div>

    <script>
        let solutionGrid = [];
        let currentExamplePage = 1;
        let currentExampleGroup = 1;
        const totalPages = 3;

        function sfc32(a, b, c, d) {
            a >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0; 
            return function() {
                var t = (a + b | 0) + d | 0;
                d = d + 1 | 0;
                a = b ^ b >>> 9;
                b = c + (c << 3) | 0;
                c = (c << 21 | c >>> 11);
                c = c + t | 0;
                return (t >>> 0) / 4294967296;
            }
        }

        function getSeededRandom(seedStr) {
            let h1 = 1779033703, h2 = 2778083391, h3 = 669920902, h4 = 253473474;
            for (let i = 0, k; i < seedStr.length; i++) {
                k = seedStr.charCodeAt(i);
                h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
                h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
                h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
                h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
            }
            return sfc32(h1, h2, h3, h4);
        }

        function generateRandomString() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function createNewPuzzle() {
            const inputField = document.getElementById('puzzleIdInput');
            const inputVal = inputField.value.trim();
            let xInput = document.getElementById('gridSize').value;
            let x = parseInt(xInput);
            if (isNaN(x) || x < 2) x = 3;
            let seed = "";

            if (inputVal) {
                if (inputVal.includes('-')) {
                    const parts = inputVal.split('-');
                    const parsedX = parseInt(parts[0]);
                    if (!isNaN(parsedX) && parsedX >= 2) {
                        x = parsedX;
                        document.getElementById('gridSize').value = x;
                    }
                    seed = parts[1];
                } else {
                    seed = inputVal;
                }
            } else {
                seed = generateRandomString();
            }

            const fullId = `${x}-${seed}`;
            document.getElementById('idLabel').innerText = "ID: " + fullId;
            inputField.value = "";

            const count = x * x;
            document.getElementById('subheading').innerText = `Fill the grid with the consecutive numbers from 1 to ${count}`;

            const rng = getSeededRandom(seed);

            let numbers = Array.from({length: count}, (_, i) => i + 1);
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(rng() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }

            solutionGrid = [];
            for (let i = 0; i < x; i++) {
                solutionGrid.push(numbers.slice(i * x, i * x + x));
            }

            const rowSums = solutionGrid.map(row => row.reduce((a, b) => a + b, 0));
            const colSums = Array(x).fill(0);
            for (let j = 0; j < x; j++) {
                for (let i = 0; i < x; i++) colSums[j] += solutionGrid[i][j];
            }

            let preFillCount = Math.max(0, (x * x) - (2 * x) - 2);
            const cellIndices = [];
            for (let i = 0; i < x; i++) {
                for (let j = 0; j < x; j++) cellIndices.push({r: i, c: j});
            }
            for (let i = cellIndices.length - 1; i > 0; i--) {
                const j = Math.floor(rng() * (i + 1));
                [cellIndices[i], cellIndices[j]] = [cellIndices[j], cellIndices[i]];
            }
            const preFilled = cellIndices.slice(0, preFillCount);

            render(x, rowSums, colSums, preFilled);
        }

        function render(x, rowSums, colSums, preFilled) {
            const assembly = document.getElementById('puzzleAssembly');
            assembly.innerHTML = "";

            const table = document.createElement('div');
            table.className = "table-proper";
            table.style.gridTemplateColumns = `repeat(${x}, 1fr)`;
            table.style.gridTemplateRows = `repeat(${x}, 1fr)`;

            for (let i = 0; i < x; i++) {
                for (let j = 0; j < x; j++) {
                    const cell = document.createElement('div');
                    cell.className = "cell";
                    
                    const isPre = preFilled.some(p => p.r === i && p.c === j);
                    if (isPre) {
                        cell.innerHTML = `<div class="pre-filled">${solutionGrid[i][j]}</div>`;
                    } else {
                        const input = document.createElement('input');
                        input.type = "number";
                        input.dataset.r = i;
                        input.dataset.c = j;
                        cell.appendChild(input);
                    }
                    table.appendChild(cell);
                }
            }
            assembly.appendChild(table);

            const rowContainer = document.createElement('div');
            rowContainer.className = "row-sums-container";
            rowContainer.style.gridTemplateRows = `repeat(${x}, 1fr)`;
            rowSums.forEach(sum => {
                const box = document.createElement('div');
                box.className = "sum-box";
                box.innerText = sum;
                rowContainer.appendChild(box);
            });
            assembly.appendChild(rowContainer);

            const colContainer = document.createElement('div');
            colContainer.className = "col-sums-container";
            colContainer.style.gridTemplateColumns = `repeat(${x}, 1fr)`;
            colSums.forEach(sum => {
                const box = document.createElement('div');
                box.className = "sum-box";
                box.innerText = sum;
                colContainer.appendChild(box);
            });
            assembly.appendChild(colContainer);
        }

        function showSolution() {
            const inputs = document.querySelectorAll('input[data-r]');
            inputs.forEach(input => {
                const r = parseInt(input.dataset.r);
                const c = parseInt(input.dataset.c);
                input.value = solutionGrid[r][c];
                input.style.color = "#2563eb";
                input.style.fontWeight = "bold";
            });
        }

        // Example Viewer Functions
        function openExample(num) {
            currentExampleGroup = num;
            document.getElementById('exampleModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Toggle groups
            document.getElementById('group-1').style.display = (num === 1) ? 'block' : 'none';
            document.getElementById('group-2').style.display = (num === 2) ? 'block' : 'none';
            
            currentExamplePage = 1;
            updatePageDisplay();
        }

        function closeExample() {
            document.getElementById('exampleModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function updatePageDisplay() {
            // Find all pages in the current group
            const pages = document.querySelectorAll(`#group-${currentExampleGroup} .example-page`);
            pages.forEach((page, index) => {
                page.classList.toggle('active', (index + 1) === currentExamplePage);
            });
            
            document.getElementById('pageIndicator').innerText = `Page ${currentExamplePage} / ${totalPages}`;
            document.getElementById('prevBtn').style.opacity = currentExamplePage === 1 ? '0.3' : '1';
            document.getElementById('nextBtn').style.opacity = currentExamplePage === totalPages ? '0.3' : '1';
            
            // Scroll modal to top on page change
            document.getElementById('exampleModal').scrollTop = 0;
        }

        function nextPage() {
            if (currentExamplePage < totalPages) {
                currentExamplePage++;
                updatePageDisplay();
            }
        }

        function prevPage() {
            if (currentExamplePage > 1) {
                currentExamplePage--;
                updatePageDisplay();
            }
        }

        // Close modal on escape
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeExample();
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') prevPage();
        });

        window.onload = createNewPuzzle;
    </script>
</body>
</html>